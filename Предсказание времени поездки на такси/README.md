# Предсказание времени поездки на такси. Задача регрессии.

## Оглавление

[1.Описание проекта](https://github.com/PavelNovikov888/practical_work/tree/master/%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%20%D1%80%D0%B5%D0%B7%D1%8E%D0%BC%D0%B5%20%D0%BD%D0%B0%20hh.ru#%D0%BE%D0%BF%D0%B8%D1%81%D0%B0%D0%BD%D0%B8%D0%B5-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%B0)

[2.Какой кейс решаем?](https://github.com/PavelNovikov888/practical_work/tree/master/%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%20%D1%80%D0%B5%D0%B7%D1%8E%D0%BC%D0%B5%20%D0%BD%D0%B0%20hh.ru#%D0%BA%D0%B0%D0%BA%D0%BE%D0%B9-%D0%BA%D0%B5%D0%B9%D1%81-%D1%80%D0%B5%D1%88%D0%B0%D0%B5%D0%BC)

[3.Краткая информация о данных](https://github.com/PavelNovikov888/practical_work/tree/master/%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%20%D1%80%D0%B5%D0%B7%D1%8E%D0%BC%D0%B5%20%D0%BD%D0%B0%20hh.ru#%D0%BA%D1%80%D0%B0%D1%82%D0%BA%D0%B0%D1%8F-%D0%B8%D0%BD%D1%84%D0%BE%D1%80%D0%BC%D0%B0%D1%86%D0%B8%D1%8F-%D0%BE-%D0%B4%D0%B0%D0%BD%D0%BD%D1%8B%D1%85)

[4.Этапы работы над проектом](https://github.com/PavelNovikov888/practical_work/tree/master/%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%20%D1%80%D0%B5%D0%B7%D1%8E%D0%BC%D0%B5%20%D0%BD%D0%B0%20hh.ru#%D1%8D%D1%82%D0%B0%D0%BF%D1%8B-%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B-%D0%BD%D0%B0%D0%B4-%D0%BF%D1%80%D0%BE%D0%B5%D0%BA%D1%82%D0%BE%D0%BC) 

[5.Результат](https://github.com/PavelNovikov888/practical_work/tree/master/%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%20%D1%80%D0%B5%D0%B7%D1%8E%D0%BC%D0%B5%20%D0%BD%D0%B0%20hh.ru#%D1%80%D0%B5%D0%B7%D1%83%D0%BB%D1%8C%D1%82%D0%B0%D1%82)

[6.Выводы](https://github.com/PavelNovikov888/practical_work/tree/master/%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%20%D1%80%D0%B5%D0%B7%D1%8E%D0%BC%D0%B5%20%D0%BD%D0%B0%20hh.ru#%D0%B2%D1%8B%D0%B2%D0%BE%D0%B4%D1%8B)


### Описание проекта
<center> <img src=https://storage.googleapis.com/kaggle-competitions/kaggle/3333/media/taxi_meter.png align="right" width="300"/> </center>
    
Нам предстоит решить настоящую задачу машинного обучения, направленную на автоматизацию бизнес-процессов. Мы построим модель, которая будет предсказывать общую продолжительность поездки такси в Нью-Йорке. 

Представим, что мы заказываем такси из одной точки Нью-Йорка в другую, причем не обязательно конечная точка должна находиться в пределах города. Сколько мы должны будем за нее заплатить? Известно, что стоимость такси в США  рассчитывается на основе фиксированной ставки + тарифная стоимость, величина которой зависит от времени и расстояния. Тарифы варьируются в зависимости от города.

В свою очередь время поездки зависит от множества факторов таких как, откуда и куда мы едете, в какое время суток мы совершаем нашу поездку, погодных условий и так далее. 

Таким образом, если мы разработаем алгоритм, способный определять длительность поездки, мы сможем прогнозировать ее стоимость самым тривиальным образом, например, просто умножая стоимость на заданный тариф. 
Сервисы такси хранят огромные объёмы информации о поездках, включая такие данные как конечная, начальная точка маршрута, дата поездки и ее длительность. Эти данные можно использовать для того, чтобы прогнозировать длительность поездки в автоматическом режиме с привлечением искусственного интеллекта.

### Какой кейс решаем?  

**Бизнес-задача:** определить характеристики и с их помощью спрогнозировать длительность поездки такси.  

**Техническая задача для специалиста в Data Science:** построить модель машинного обучения, которая на основе предложенных характеристик клиента будет предсказывать числовой признак - время поездки такси. То есть решить задачу регрессии.  

**Основные цели проекта:**  

1. Сформировать набор данных на основе нескольких источников информации  

2. Спроектировать новые признаки с помощью Feature Engineering и выявить наиболее значимые при построении модели  

3. Исследовать предоставленные данные и выявить закономерности  

4. Построить несколько моделей и выбрать из них наилучшую по заданной метрике  

5. Спроектировать процесс предсказания времени длительности поездки для новых данных  


*Метрика качества*

Определим метрику, по которой мы будем измерять качество наших моделей. Мы будем следовать канонам исходного соревнования на Kaggle и в качестве метрики использовать RMSLE (Root Mean Squared Log Error), которая вычисляется как:
$$RMSLE = \sqrt{\frac{1}{n}\sum_{i=1}^n(log(y_i+1)-log(\hat{y_i}+1))^2},$$
где:
* $y_i$ - истинная длительность i-ой поездки на такси (trip_duration)
* $\hat{y_i}$- предсказанная моделью длительность i-ой поездки на такси

Заметим, что логарифмирование целевого признака мы уже провели заранее, поэтому нам будет достаточно вычислить метрику RMSE для модели, обученной прогнозировать длительность поездки такси в логарифмическом масштабе:
$$z_i=log(y_i+1),$$
$$RMSLE = \sqrt{\frac{1}{n}\sum_{i=1}^n(z_i-\hat{z_i})^2}=\sqrt{MSE(z_i,\hat{z_i})}$$ 

Что такое среднеквадратическая логарифмическая ошибка?  

Среднеквадратическая логарифмическая ошибка (MSLE) может быть интерпретирована как мера отношения между истинными и предсказанными значениями.   
Среднеквадратическая логарифмическая ошибка, как следует из названия, является разновидностью среднеквадратичной ошибки. MSLE заботит только процентная разница.

*Что практикуем*

Во время выполнения проекта мы отработаем:  

* навыки работы с несколькими источниками данных,  

* генерации признаков,  

* разведывательного анализа и визуализации данных,  

* отбора признаков и, конечно же,   

* построения моделей машинного обучения!  


### Краткая информация о данных
Задача, которую мы будем решать, была представлена в качестве [Data Science-соревнования](https://www.kaggle.com/competitions/nyc-taxi-trip-duration/overview) с призовым фондом в 30 000 $ на платформе Kaggle в 2017 году.  

Нам предоставлен набор данных, содержащий информацию о поездках на жёлтом такси в Нью-Йорке за 2016 год. Первоначально данные были выпущены Комиссией по Такси и Лимузинам Нью-Йорка и включают в себя информацию о времени поездки, географических координатах, количестве пассажиров и несколько других переменных. 

1. Исходный датасет taxi_data.zip 
2. Данные о праздничных днях в США в 2016 году holyday_data.zip   
3. Данные из OSRM (Open Source Routing Machine) — это открытый бесплатный ресурс, который активно используется во многих сервисах, предполагающих построение кратчайшего маршрута. Он позволяет не только построить оптимальный кусочно-линейный путь из точки А в точку B, но также узнать его примерную длительность, длину, а также подробную информацию о количестве шагов, которые необходимо преодолеть по пути (количество поворотов) osrm_data_train.zip 
4. Набор данных, содержащий информацию о погодных условиях в Нью-Йорке в 2016 году weather_data.zip
5. Файл для submit на сайт соревнования в Kaggle  submission_gb.csv

### Этапы работы над проектом

1. Знакомство с данными, базовый анализ и расширение данных  

2. Разведывательный анализ данных (EDA)  

3. Отбор и преобразование признаков  

4. Решение задачи регрессии: линейная регрессия и деревья решений  

5. Решение задачи регрессии: ансамблевые методы и построение прогноза  

6. Подведение итогов


### Результат

В результате исследования данных получены следующие результаты:  
1. Модель линейной регрессии LinearRegression()  
    RMSLE_train: 0.54  
    RMSLE_valid: 0.54  
2. Модель полиномиальной регрессии 2-ой степени PolynomialFeatures()    
    RMSLE_train: 0.47  
    RMSLE_valid: 0.70  
3. Модель полиномиальной регрессии 2-ой степени с L2-регуляризацией Ridge()  
    RMSLE_train: 0.48  
    RMSLE_valid: 0.48 
4. Модель дерева решений DecisionTreeRegressor()  
    RMSLE_train: 0.00  
    RMSLE_valid: 0.56  
5. Модель случайного леса RandomForestRegressor()  
    RMSLE_train: 0.40  
    RMSLE_valid: 0.41  
6. Модель градиентного бустинга над деревьями решений GradientBoostingRegressor()  
    RMSLE_train: 0.37  
    RMSLE_valid: 0.39  
7. Модель экстремального градиентного бустинга XGBoost  
    Modeling RMSLE 0.39132

### Выводы

Наилучший результат, т.е наименьшее значение RMSLE 0.39 на валидационной выборке, показала модель Градиентный бустинг над деревьями решений

:arrow_up: [к оглавлению](https://github.com/PavelNovikov888/practical_work/tree/master/%D0%90%D0%BD%D0%B0%D0%BB%D0%B8%D0%B7%20%D1%80%D0%B5%D0%B7%D1%8E%D0%BC%D0%B5%20%D0%BD%D0%B0%20hh.ru#%D0%BE%D0%B3%D0%BB%D0%B0%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D0%B5)
